<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>V-Transer Panel</title>
  <link rel="stylesheet" href="sidepanel.css" />
</head>
<body>
  <div id="panel">

    <!-- ‚úÖ LEFT: main column (center screen + bottom bar fixed) -->
    <div class="main-col">
      <!-- center screens -->
      <div class="view-container">
        <div class="content-flipper">

          <!-- CHAT VIEW -->
          <div id="chat-content" class="content-view hidden">
            <div class="main-header">
              <p>T√¥i c√≥ th·ªÉ h·ªó tr·ª£ g√¨ cho b·∫°n?</p>
            </div>

            <div class="action-buttons">
              <button id="chatActionFullscreenBtn" class="action-btn" type="button">
                <img src="icons/maximize.svg" alt="" class="action-btn-icon" /> To√†n m√†n h√¨nh
              </button>
              <button id="chatActionRetrieveBtn" class="action-btn" type="button" data-rag-picker-trigger="1">
                <img src="icons/database.svg" alt="" class="action-btn-icon" /> Truy xu·∫•t th√¥ng tin
              </button>
              <button id="chatActionStoreBtn" class="action-btn" type="button">
                <img src="icons/star.svg" alt="" class="action-btn-icon" /> Kho l∆∞u tr·ªØ
              </button>
              <button id="chatActionDocBtn" class="action-btn" type="button">
                <img src="icons/file-text.svg" alt="" class="action-btn-icon" /> V·∫Ω h√¨nh t√†i li·ªáu
              </button>
            </div>

            <div class="chat-history-area"></div>

            <div class="chat-input-area">
              <div class="input-header">
                <button class="chip-button" type="button">
                  <img src="icons/database.svg" alt="" class="input-btn-icon" />Truy xu·∫•t th√¥ng tin
                </button>
                <button class="chip-button" type="button">
                  <img src="icons/brain.svg" alt="" class="input-btn-icon" />Suy lu·∫≠n (R1)
                </button>
              </div>
              <div id="chatRagSelectionBar" class="chat-rag-selection-bar hidden"></div>

              <div class="textarea-wrapper">
                <textarea placeholder="H√£y vi·∫øt g√¨ ƒë√≥"></textarea>
                <button id="icon-btn-send" class="icon-btn-simple" title="send" type="button"></button>
              </div>
            </div>
          </div>

          <!-- TRANSCRIPT VIEW -->
          <div id="transcript-content" class="content-view">
            <div class="transcript-box">
              <div class="transcript-header">
                <h3>N·ªôi dung chi ti·∫øt</h3>
                <p class="transcript-url">Website: (ch∆∞a b·∫Øt ƒë·∫ßu)</p>
              </div>

              <div class="transcript-body">
                <div class="placeholder-text transcript-placeholder">
                  Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu.
                </div>
              </div>

              <div class="transcript-live-footer">
                <span>Live</span>
              </div>
            </div>

            <div class="transcript-controls-row">
              <button class="transcript-btn1 start" type="button" aria-label="Start/Stop"></button>
            </div>

            <div class="transcript-actions-row">
              <button id="btn-subtitle" class="transcript-btn" type="button">
                <img src="icons/phude.svg" alt="" class="action-btn-icon" />Ph·ª• ƒë·ªÅ
              </button>
              <button id="btn-subtitle-trans" class="transcript-btn" type="button">
                <img src="icons/dichphude.svg" alt="" class="action-btn-icon" />Phi√™n d·ªãch
              </button>
              <button id="btn-voice" class="transcript-btn" type="button">
                <img src="icons/giongnoi.svg" alt="" class="action-btn-icon" />Gi·ªçng n√≥i
              </button>
            </div>
          </div>

          <!-- ‚úÖ HISTORY VIEW (NEW) -->
          <div id="history-content" class="content-view hidden">
            <div class="history-box">
              <div class="history-header">
                <h3>L·ªãch s·ª≠</h3>
                <p class="history-sub">
                <p id="historyUserIdNote" class="history-user-note"></p>
                <div class="history-search-row">
                  <input
                    id="historySearchInput"
                    class="history-search-input"
                    type="search"
                    placeholder="T√¨m theo website ho·∫∑c n·ªôi dung..."
                    autocomplete="off"
                  />
                  <button id="historyRefreshBtn" class="history-refresh-btn" type="button">L√†m m·ªõi</button>
                </div>
              </div>

              <div class="history-body">
                <div id="historyLoading" class="history-loading hidden">ƒêang t·∫£i l·ªãch s·ª≠...</div>
                <div id="historyEmpty" class="history-empty hidden">Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠.</div>
                <div id="historyList" class="history-list" role="list"></div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- ‚úÖ BOTTOM BAR: fixed for ALL features -->
      <div class="bottom-bar">
        <div class="bottom-left">
          <span id="bottomGreeting" class="bottom-greeting">Xin ch√†o</span>
          <button class="login-btn" id="loginLink" type="button">ƒêƒÉng nh·∫≠p</button>
        </div>

        <div class="icon-group">
          <button id="icon-btn-gift" class="icon-btn-simple" title="gift" type="button"></button>
          <button id="icon-btn-heart" class="icon-btn-simple" title="heart" type="button"></button>
          <button id="icon-btn-help" class="icon-btn-simple" title="help" type="button"></button>
          <button id="icon-btn-mail" class="icon-btn-simple" title="mail" type="button"></button>
        </div>
      </div>
    </div>

    <!-- ‚úÖ RIGHT: toolbar fixed -->
    <div class="toolbar">
      <div class="toolbar-mini-row">
        <button id="btn-collapse" class="icon-btn mini" title="Thu g·ªçn" type="button"></button>
        <button id="btn-fullscreen" class="icon-btn mini" title="To√†n m√†n h√¨nh" type="button"></button>
      </div>

      <div class="toolbar-item nav-item">
        <button id="btn-transcript" class="icon-btn nav-btn active" data-view="transcript" title="Transcript" type="button"></button>
        <span class="icon-label">Phi√™n d·ªãch</span>
      </div>

      <div class="toolbar-item nav-item">
        <button id="btn-chat" class="icon-btn nav-btn" data-view="chat" title="Chat" type="button"></button>
        <span class="icon-label">Tr·ª£ l√Ω ·∫£o</span>
      </div>

      <div class="toolbar-item nav-item">
        <button id="btn-history" class="icon-btn nav-btn" data-view="history" title="History" type="button"></button>
        <span class="icon-label">L·ªãch s·ª≠</span>
      </div>

      <div class="toolbar-item nav-item">
        <button id="btn-more" class="icon-btn" title="More" type="button"></button>
        <span class="icon-label">Th√™m</span>
      </div>

      <div class="toolbar-spacer" aria-hidden="true"></div>

      <div class="toolbar-item toolbar-footer">
        <button id="btn-setting" class="icon-btn" title="Setting" type="button"></button>
      </div>

      <div class="toolbar-item toolbar-footer">
        <button id="btnAccount" class="icon-btn" title="Account" type="button" data-vt-account></button>
      </div>
    </div>
  </div>

  <!-- HISTORY DETAIL MODAL -->
  <div id="historyDetailModal" class="history-modal hidden" aria-hidden="true">
    <div class="history-modal-backdrop" data-history-close="1"></div>
    <div class="history-modal-card" role="dialog" aria-modal="true" aria-label="Chi ti·∫øt transcript">
      <button id="historyDetailClose" class="history-modal-close" type="button" aria-label="ƒê√≥ng">√ó</button>
      <div class="history-modal-head">
        <h3 id="historyDetailTitle" class="history-modal-title">Chi ti·∫øt</h3>
        <p id="historyDetailMeta" class="history-modal-meta"></p>
      </div>
      <pre id="historyDetailContent" class="history-modal-content">ƒêang t·∫£i n·ªôi dung...</pre>
      <div class="history-modal-actions">
        <button id="historyDownloadBtn" class="history-download-btn" type="button" disabled>T·∫£i xu·ªëng file</button>
      </div>
    </div>
  </div>

  <!-- CHAT RAG PICKER (small popup) -->
  <div id="chatRagPicker" class="rag-picker hidden" aria-hidden="true">
    <div class="rag-picker-header">
      <div class="rag-picker-title-row">
        <h3 class="rag-picker-title">Ngu·ªìn th√¥ng tin</h3>
        <button id="chatRagPickerClose" class="rag-picker-close" type="button" aria-label="ƒê√≥ng">√ó</button>
      </div>
      <div class="rag-picker-search-row">
        <input id="chatRagSearch" class="rag-picker-search" type="search" placeholder="T√¨m ki·∫øm..." autocomplete="off" />
        <button id="chatRagPinBtn" class="rag-pin-btn" type="button">X√°c nh·∫≠n</button>
      </div>
    </div>
    <div id="chatRagPickerLoading" class="rag-picker-loading hidden">ƒêang t·∫£i ...</div>
    <div id="chatRagPickerEmpty" class="rag-picker-empty hidden">Ch∆∞a c√≥ n·ªôi dung.</div>
    <div id="chatRagPickerList" class="rag-picker-list" role="list"></div>
  </div>

  <!-- CHAT RAG DETAIL MODAL (large center) -->
  <div id="chatRagDetailModal" class="history-modal hidden" aria-hidden="true">
    <div class="history-modal-backdrop" data-chat-rag-close="1"></div>
    <div class="history-modal-card" role="dialog" aria-modal="true" aria-label="Chi ti·∫øt">
      <button id="chatRagDetailClose" class="history-modal-close" type="button" aria-label="ƒê√≥ng">√ó</button>
      <div class="history-modal-head">
        <h3 id="chatRagDetailTitle" class="history-modal-title">Chi ti·∫øt</h3>
        <p id="chatRagDetailMeta" class="history-modal-meta"></p>
      </div>
      <pre id="chatRagDetailContent" class="history-modal-content">ƒêang t·∫£i n·ªôi dung...</pre>
    </div>
  </div>

  <!-- Busy modal -->
  <div id="vtBusyModal" class="vt-busy hidden" role="alertdialog" aria-live="assertive">
    <div class="vt-busy-card">
      <button id="vtBusyClose" class="vt-busy-close" type="button" aria-label="ƒê√≥ng">√ó</button>
      <div class="vt-busy-text">H·ªá th·ªëng ƒëang b·∫≠n, vui l√≤ng th·ª≠ l·∫°i sau.</div>
      <img src="icons/busy.gif" alt="ƒêang x·ª≠ l√Ω" class="vt-busy-img" />
    </div>
  </div>

  <!-- Error modal -->
  <div id="vtErrorModal" class="vt-modal hidden" role="alertdialog" aria-live="assertive">
    <div class="vt-modal-card">
      <button id="vtErrorClose" class="vt-modal-close" type="button" aria-label="ƒê√≥ng">√ó</button>
      <div class="vt-modal-text">ƒê√£ x·∫£y ra l·ªói.</div>
    </div>
  </div>

  <!-- AUTH OVERLAY -->
  <div id="vtAuthOverlay" class="vt-auth-overlay vt-hidden" aria-hidden="true">
    <div id="vtAuthBackdrop" class="vt-auth-backdrop"></div>
    <div class="vt-auth-sheet" role="dialog" aria-modal="true" aria-label="ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω">
      <iframe id="vtAuthFrame" class="vt-auth-frame" src="" title="V-Transer Auth" loading="lazy"></iframe>
    </div>
  </div>

  <!-- ACCOUNT MENU -->
  <div id="vtAccountOverlay" class="vt-account-overlay vt-hidden" aria-hidden="true">
    <div id="vtAccountBackdrop" class="vt-account-backdrop"></div>

    <div class="vt-account-popover" role="dialog" aria-modal="false" aria-label="Account">
      <div class="vt-acc-top">
        <div class="vt-acc-avatar">
          <img id="vtAccAvatar" class="vt-acc-avatar-img hidden" alt="" />
          <div id="vtAccAvatarFallback" class="vt-acc-avatar-fallback">U</div>
        </div>

        <div class="vt-acc-title">
          <div class="vt-acc-name-row">
            <div id="vtAccName" class="vt-acc-name">User</div>
            <div id="vtAccPlan" class="vt-acc-pill">Free</div>
          </div>
          <div id="vtAccEmail" class="vt-acc-email">email@example.com</div>
        </div>
      </div>

      <div class="vt-acc-credits">
        <div class="vt-acc-credits-icon" aria-hidden="true">‚ú®</div>
        <div class="vt-acc-credits-text">
          <div class="vt-acc-credits-title">Ho√†n th√†nh nhi·ªám v·ª• ƒë·ªÉ</div>
          <div class="vt-acc-credits-sub"><b>Nh·∫≠n th√™m Credits</b></div>
        </div>
      </div>

      <div class="vt-acc-menu">
        <button class="vt-acc-item" data-vt-acc-action="whats_new" type="button">
          <span class="vt-acc-ico">üîî</span> <span>Tin t·ª©c</span>
        </button>
        <button class="vt-acc-item" data-vt-acc-action="rewards" type="button">
          <span class="vt-acc-ico">üèÜ</span> <span>Trung t√¢m ph·∫ßn th∆∞·ªüng</span>
        </button>
        <button class="vt-acc-item" data-vt-acc-action="my_account" type="button">
          <span class="vt-acc-ico">üë§</span> <span>T√†i kho·∫£n</span>
        </button>
        <button class="vt-acc-item" data-vt-acc-action="my_website" type="button">
          <span class="vt-acc-ico">üóÇÔ∏è</span> <span>Trang</span>
        </button>
        <button class="vt-acc-item" data-vt-acc-action="help" type="button">
          <span class="vt-acc-ico">‚ùì</span> <span>Trung t√¢m h·ªó tr·ª£</span>
        </button>
        <button class="vt-acc-item" data-vt-acc-action="feedback" type="button">
          <span class="vt-acc-ico">‚úâÔ∏è</span> <span>ƒê√°nh gi√°</span>
        </button>

        <div class="vt-acc-sep"></div>

        <button id="vtAccLogout" class="vt-acc-item vt-acc-logout" type="button">
          <span class="vt-acc-ico">‚Ü©Ô∏è</span> <span>ƒêƒÉng xu·∫•t</span>
        </button>
      </div>

      <div class="vt-acc-social">
        <button class="vt-social-btn" type="button" aria-label="X">X</button>
        <button class="vt-social-btn" type="button" aria-label="Discord">üí¨</button>
        <button class="vt-social-btn" type="button" aria-label="YouTube">‚ñ∂Ô∏è</button>
        <button class="vt-social-btn" type="button" aria-label="LinkedIn">in</button>
      </div>

      <div id="vtAccToast" class="vt-acc-toast hidden"></div>
    </div>
  </div>

  <!-- MY ACCOUNT (EDIT PROFILE) OVERLAY -->
  <div id="vtProfileOverlay" class="vt-profile-overlay vt-hidden" aria-hidden="true">
    <div id="vtProfileBackdrop" class="vt-profile-backdrop"></div>

    <div class="vt-profile-sheet" role="dialog" aria-modal="true" aria-label="T√†i kho·∫£n c·ªßa t√¥i">
      <div class="vt-profile-header">
        <div class="vt-profile-title">T√†i kho·∫£n c·ªßa t√¥i</div>
        <button id="vtProfileClose" class="vt-profile-close" type="button" aria-label="ƒê√≥ng">√ó</button>
      </div>

      <div class="vt-profile-body">
        <div class="vt-profile-avatar-row">
          <div class="vt-profile-avatar">
            <img id="vtProfileAvatar" class="vt-profile-avatar-img hidden" alt="" />
            <div id="vtProfileAvatarFallback" class="vt-profile-avatar-fallback">U</div>
          </div>

          <div class="vt-profile-avatar-actions">
            <label class="vt-profile-file-btn">
              Ch·ªçn ·∫£nh
              <input id="vtProfileFile" type="file" accept="image/*" class="hidden" />
            </label>

            <button id="vtProfileRemoveAvatar" class="vt-profile-ghost-btn" type="button">
              X√≥a ·∫£nh
            </button>
          </div>
        </div>

        <label class="vt-profile-lbl">·∫¢nh ƒë·∫°i di·ªán</label>
        <input id="vtProfileAvatarUrl" class="vt-profile-inp" type="text" placeholder="https://... ho·∫∑c data:image/..." />

        <label class="vt-profile-lbl">Email</label>
        <input id="vtProfileEmail" class="vt-profile-inp" type="text" disabled />

        <label class="vt-profile-lbl">H·ªç v√† t√™n</label>
        <input id="vtProfileFullName" class="vt-profile-inp" type="text" placeholder="Nh·∫≠p t√™n hi·ªÉn th·ªã" />

        <div class="vt-profile-actions">
          <button id="vtProfileCancel" class="vt-profile-ghost-btn" type="button">H·ªßy</button>
          <button id="vtProfileSave" class="vt-profile-primary-btn" type="button" disabled>L∆∞u</button>
        </div>

        <div id="vtProfileToast" class="vt-profile-toast hidden"></div>
      </div>
    </div>
  </div>

  <script src="auth/config.js"></script>
  <script src="auth/auth_host.js"></script>
  <script src="sidepanel_history.js"></script>
  <script src="sidepanel.js"></script>
</body>
</html>
